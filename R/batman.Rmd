---
title: "BATMAN"
output: github_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, #
  warning=FALSE, 
  message=FALSE 
)
```

```{r import_pkgs}
# Setup mirroring options
options(repos = c(CRAN = "https://mirrors.tuna.tsinghua.edu.cn/CRAN/"))
options(BioC_mirror = "https://mirrors.tuna.tsinghua.edu.cn/bioconductor")

# Define the list of packages that need to be loaded
required_packages <- c(
  "httr",
  "dplyr", 
  "data.table", 
  "stringr", 
  "tidyr", 
  "readxl"
  )

# Silent installation and loading of all packages
invisible(
  lapply(required_packages, function(pkg) {
    # Check if the package has been installed
    if (!requireNamespace(pkg, quietly = TRUE)) {
      # Silent installation of CRAN package
      install.packages(pkg, repos = getOption("repos"), quiet = TRUE)
    }
    
    # Silent loading package
    suppressPackageStartupMessages(
      suppressWarnings(
        library(pkg, character.only = TRUE, quietly = TRUE)
      )
    )
  })
)

# Bioconductor packages
bioc_packages <- c("DESeq2", "ComplexHeatmap")
if (length(bioc_packages) > 0) {
  # Check if BiocManager is installed
  if (!requireNamespace("BiocManager", quietly = TRUE)) {
    install.packages("BiocManager", quiet = TRUE)
    suppressPackageStartupMessages(library("BiocManager", quietly = TRUE))
  }
  
  # Silent installation and loading of Bioconductor package
  invisible(
    lapply(bioc_packages, function(bpkg) {
      if (!requireNamespace(bpkg, quietly = TRUE)) {
        BiocManager::install(bpkg, update = FALSE, ask = FALSE, quiet = TRUE)
      }
      suppressPackageStartupMessages(
        suppressWarnings(
          library(bpkg, character.only = TRUE, quietly = TRUE)
        )
      )
    })
  )
}

# Verify if the package was successfully loaded
loaded_packages <- sapply(c(required_packages, bioc_packages), 
                          requireNamespace, quietly = TRUE)

# Output packages that failed installation
if (!all(loaded_packages)) {
  failed <- names(loaded_packages)[!loaded_packages]
  warning("The following packages failed to load: ", paste(failed, collapse = ", "))
}

# Clean up temporary variables
rm(required_packages, bioc_packages, loaded_packages)
```

## Download datasets from BATMAN-TCM
```{r eval=FALSE}

```


